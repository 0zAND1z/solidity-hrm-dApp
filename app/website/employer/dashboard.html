<!DOCTYPE html>
<html>
<head>
  <title>Dashboard | Employer</title>
  <script
  src="https://code.jquery.com/jquery-3.2.1.min.js"
  integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
  crossorigin="anonymous"></script>

  <script type="text/javascript" src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
  <script type="text/javascript" src="/lib/js/jquery.min.js"></script>
  <link rel="stylesheet" type="text/css" href="/app/lib/css/bootstrap.min.css" />
  <link rel="stylesheet" type="text/css" href="/style.css" />
</head>
<body>
  <h1 class="jumbotron">Aicumen Job Positions</h1>
  <br>
  <ul id="jobsList">
    <li class="row" id="jobsHeader">
      <label class="col-md-4 font-weight-bold">JOB id</label>
      <label class="col-md-4 font-weight-bold">JOB title</label>
      <!-- <label class="col-md-4 font-weight-bold">Set Status Options</label> -->
    </li>
  </br>
</ul>
</br>
<div hidden id="arrJobNo"></div>
<div class="mx-auto div-centered"><a id="addNewJob" type="button" class="btn btn-success" href="/website/employer/addnewjob.html">Create a job opening</a></div>
</body>

<script type="text/javascript">
$('document').ready(function(){
  //refresh jobsList
  refreshJobs();
});
function showApplicationForm(){
  document.getElementById("applicationForm").removeAttribute("hidden");
  document.getElementByID("jobID").value;
};

function refreshJobs(){

  var arrJobNo = new Array();
  var jobsList = new Array();
  // var jobsList = '{ "jobs" : [' +
  // '{ "jobID":"123" , "jobTitle":"UI", "jobURL":"Job Details", "jobDescription":"google-docs JD link", "isActive" : false},' +
  // '{ "jobID":"345" , "jobTitle":"Full-stack", "jobURL":"Job Details", "jobDescription":"google-docs JD link", "isActive" : true} ]}';

  $.post("/getJobs", function(data){
    if(data!=null)
    {
      arrJobNo = data;
      console.log(arrJobNo);
      // jobsList = data;
    }
  });

  setTimeout(function(){
    console.log(arrJobNo);
    for(var i = 0; i < arrJobNo.length; i++){
      $.post("/getJobsFromJobNo", {jobNo:arrJobNo[i]}, function(data){
        jobsList[i] = new Array();
        if(data!=null)
        {
          // console.log(data);
          jobsList[i] = data;
          console.log(jobsList[i][2]);
          $("#jobsList").append('<li class="row ' + '">' +
          '<div class="col-md-4">' + jobsList[i][1] + '</div>' +
          '<a class="col-md-4 font-weight-bold" href="/viewapplicants.html?jobID=' + jobsList[i][1] + '">' + jobsList[i][2] + '</a>' +
          // '<input type="button" onclick="toggleStatus('+parsedJson.jobs[i].jobID +','+parsedJson.jobs[i].isActive+')" class="col-md-1 btn '+ buttonClass + ' statusButton" value="'+ status +'">' +
          '<a href="/editJob.html?jobID=' + jobsList[i][1] +'" class="col-md-1 offset-md-1 btn btn-info">Edit Job</a>' +
          '</li>' +
          '<br>');
        }
      });
    }
  }, 400);
  // var parsedJson = JSON.parse(jobsList);

    for(i=0; i < arrJobNo.length ; i++){
      console.log(jobsList[i]);

      var jobs = document.getElementsByClassName("jobs");

      // var status, buttonClass, liClass;
      // if(parsedJson.jobs[i].isActive){
      //   status = "Deactivate";
      //   buttonClass = "btn-danger";
      //   liClass = "";
      // }else {
      //   status = "Activate";
      //   buttonClass = "btn-success";
      //   liClass = "bg-secondary"
      // }

      var jobID = jobsList[0];


      $("#jobsList").append('<li class="row ' + '">' +
      '<div class="col-md-4">' + jobID + '</div>' +
      '<a class="col-md-4 font-weight-bold" href="/viewapplicants.html?jobID=' + parsedJson.jobs[i].jobID + '">' + parsedJson.jobs[i].jobTitle + '</a>' +
      // '<input type="button" onclick="toggleStatus('+parsedJson.jobs[i].jobID +','+parsedJson.jobs[i].isActive+')" class="col-md-1 btn '+ buttonClass + ' statusButton" value="'+ status +'">' +
      '<a href="/editJob.html?jobID=' + parsedJson.jobs[i].jobID +'" class="col-md-1 offset-md-1 btn btn-info">Edit Job</a>' +
      '</li>' +
      '<br>');
    };
}

function toggleStatus(jobID, realStatus){

  $.post("/setJobStatus",  {jobID: jobID, newStatus : !realStatus} , function(data){
    if(data===true)
    {
      // alert("status set");
      // jobsList = data;
    }
  });
  $("#jobsList").html('');
  refreshJobs();
}

</script>
</html>
